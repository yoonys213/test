<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>중화적정 결과</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            height: 100vh;
            margin: 0;
            background-color: #030BA6;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        .container {
            width: 90%;
            max-width: 800px;
            text-align: center;
        }
        .result-title {
            font-size: 50px;
            font-weight: bold;
            margin-bottom: 40px;
        }
        .result-value {
            font-size: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 50px;
        }
        .value-box {
            padding: 15px 25px;
            font-size: 60px;
            text-align: center;
            border: 2px solid white;
            border-radius: 6px;
            margin: 0 10px;
            background-color: rgba(255, 255, 255, 0.1);
        }
        .plus-minus {
            font-size: 60px;
            margin: 0 10px;
        }
        .back-btn {
            padding: 20px 40px;
            font-size: 30px;
            font-weight: bold;
            background-color: white;
            color: #030BA6;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 40px;
        }
        .back-btn:hover {
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="result-title">미지 용액의 농도</div>
        <div class="result-value">
            <span class="value-box" id="finalConcValue"></span>
            <span class="plus-minus">±</span>
            <span class="value-box" id="finalConcUncertainty"></span>
            <span>M</span>
        </div>
        <button class="back-btn" onclick="window.location.href='titration1.html'">돌아가기</button>
    </div>

    <script>
        // localStorage에서 값 가져오기
        const M = parseFloat(localStorage.getItem('titration_M'));
        const alpha = parseFloat(localStorage.getItem('titration_alpha'));
        const V1 = parseFloat(localStorage.getItem('titration_V1'));
        const beta = parseFloat(localStorage.getItem('titration_beta'));
        const V2 = parseFloat(localStorage.getItem('titration_V2'));
        const theta = parseFloat(localStorage.getItem('titration_theta'));
        const n1 = parseInt(localStorage.getItem('titration_n1'));
        const n2 = parseInt(localStorage.getItem('titration_n2'));

        // 값이 없을 경우 오류 처리
        if (isNaN(M) || isNaN(alpha) || isNaN(V1) || isNaN(beta) || 
            isNaN(V2) || isNaN(theta) || isNaN(n1) || isNaN(n2)) {
            alert("입력값이 없습니다. 이전 페이지에서 값을 입력해주세요.");
            window.location.href = "titration1.html";
        }

        // 정확한 반올림 함수 (0.051 → 0.05)
        function preciseRound(value, decimals) {
            const factor = 10 ** decimals;
            const multiplied = value * factor;
            const decimalPart = (multiplied - Math.floor(multiplied)).toFixed(3);
            
            if (decimalPart === "0.500") {
                const intPart = Math.floor(multiplied);
                return (intPart % 2 === 0) ? intPart / factor : (intPart + 1) / factor;
            }
            return Math.round(multiplied) / factor;
        }

        // 중화적정 계산 함수
        function calculateTitration() {
            // 1. 미지 용액 농도 계산: [H] = (M × V1 × n2) / (V2 × n1)
            const H = (M * V1 * n2) / (V2 * n1);
            
            // 2. 상대 불확도 계산 (합연산)
            const relUnc = (alpha/M) + (beta/V1) + (theta/V2);
            
            // 3. 절대 불확도 계산
            const deltaH = H * relUnc;
            
            // 4. 반올림 처리
            return {
                conc: preciseRound(H, 2),
                unc: preciseRound(deltaH, 2)
            };
        }

        // 결과 표시
        function displayResults() {
            const { conc, unc } = calculateTitration();
            document.getElementById('finalConcValue').textContent = conc.toFixed(2);
            document.getElementById('finalConcUncertainty').textContent = unc.toFixed(2);
            
            // 디버깅 로그 (필요시 주석 해제)
            /*
            console.log("계산식: (M × V1 × n2) / (V2 × n1)");
            console.log(`= (${M} × ${V1} × ${n2}) / (${V2} × ${n1})`);
            console.log(`상대불확도: (${alpha}/${M}) + (${beta}/${V1}) + (${theta}/${V2})`);
            console.log(`= ${(alpha/M + beta/V1 + theta/V2).toFixed(4)}`);
            console.log(`절대불확도: ${H} × ${relUnc} = ${deltaH}`);
            */
        }

        // 페이지 로드 시 실행
        window.onload = displayResults;
    </script>
</body>
</html>